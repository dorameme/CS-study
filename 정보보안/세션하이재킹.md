
# 세션 하이재킹 (Session Hijacking)

## 개요

세션 하이재킹은 인증 완료 후 발급된 세션 식별자(세션 쿠키, 토큰 등)를 탈취하거나 조작하여       
정상 사용자인 것처럼 세션을 도용하는 공격.   
공격자는 탈취한 세션으로 권한 있는 행위를 수행하거나 추가 정보를 탈취한다.

---

## 주요 유형 및 원리

### 네트워크 기반 중간자 공격 (MITM / Sidejacking)

* **원리**: 평문 HTTP 또는 약한 TLS 환경에서 패킷을 가로채 세션 쿠키를 획득한다.
* **예시**: 공용 Wi-Fi에서 `Cookie: sessionid=...`를 캡처해 동일 세션으로 서비스 접근한다.

### XSS를 이용한 쿠키 탈취

* **원리**: 취약한 웹페이지에 삽입한 스크립트로 `document.cookie`를 읽어 외부로 전송한다.
* **예시**: 게시판에 악성 스크립트를 삽입해 관리자의 세션을 전송받는다.

### 세션 고정(Session Fixation)

* **원리**: 공격자가 미리 생성한 세션 ID를 피해자에게 사용하게 한 뒤 피해자가 로그인하면 동일 세션으로 권한 획득한다.
* **예시**: 공격자가 만든 링크로 접속 유도 → 로그인 후 공격자가 세션 사용.

### 세션 재생(Session Replay)

* **원리**: 이전에 캡처한 요청(토큰 포함)을 재전송해 같은 동작을 재현한다.
* **예시**: 결제 요청을 캡처해 같은 요청을 재전송하여 중복 결제 시도.

### 로컬 탈취(악성코드 / 브라우저 확장)

* **원리**: 로컬에서 브라우저 쿠키 저장소 또는 세션 파일을 읽어 전송한다.
* **예시**: 악성 확장 프로그램이 쿠키를 C2 서버로 전송한다.

---

## 탐지 방법

### 네트워크·트래픽 기반

* **HTTP 헤더 검사**: 평문 통신에서 `Cookie` 노출 여부 확인.
* **TLS 이상 탐지**: 인증서 지문/체인 변경 모니터링.
* **IDS/패턴 탐지**: 비정상적 POST 재전송, 반복 요청 패턴 탐지.

### 로그·행위 기반

* **동시성 탐지**: 동일 세션 ID가 서로 다른 IP/기기에서 동시 사용되는 경우 경보.
* **지리적·시간 불일치**: 짧은 시간 내 다른 국가 접근 발생 시 의심.
* **행동 이상**: 평상시와 다른 고권한 행위(대량 다운로드 등) 발생 시 경보.
* **세션 재생 탐지**: 동일 POST 페이로드 반복, nonce/일회용 토큰 실패 탐지.

### 호스트·애플리케이션 기반

* **프러미스큐어스 모드 및 캡처 도구 탐지**: 호스트에서 `tcpdump`/`wireshark` 등 실행 여부 탐지.
* **XSS 징후 모니터링**: 입력값에 스크립트 패턴 주입 시도 탐지.
* **파일 무결성**: 브라우저 쿠키 DB 변조 감시.
---
## 대응 및 완화 방법

### 전송 계층 보안

* 모든 인증·세션 관련 통신은 **HTTPS/TLS**로 보호한다.
* TLS 인증서 및 암호화 스위트는 최신 권장안으로 유지한다.

### 세션 관리 강화

* **Secure**, **HttpOnly**, **SameSite** 속성으로 쿠키를 설정한다.
* 로그인 시 및 권한 상승 시 **세션 ID 재발급**(regenerate)한다.
* 세션의 **Idle/Absolute timeout**을 설정한다.
* 민감 작업에 대해 **재인증(MFA)** 을 요구한다.
* 세션 바인딩(IP/UA/디바이스 지문 등)을 적용하되 정상 환경(프록시, 모바일) 고려해 유연하게 설계한다.

### 애플리케이션 보안

* **XSS 방지**: 입력 검증·출력 이스케이프 및 CSP 적용한다.
* **CSRF 방지**: CSRF 토큰 사용, SameSite 쿠키 사용으로 보완한다.
* **세션 고정 방지**: 로그인 시 기존 세션 무효화 후 새 세션 발급한다.

### 운영·탐지·대응

* **SIEM**에 동시 접속·지리적 이동 규칙을 등록하고 실시간 경보를 구성한다.
* 의심 발생 시 **즉시 세션 무효화(Invalidate)** 및 해당 사용자의 세션 강제 로그아웃을 수행한다.
* 의심 호스트는 **격리**하고 pcap·서버 로그·세션 DB 스냅샷을 수집해 포렌식을 진행한다.
* 로컬에서 패킷 캡처 도구나 키로거 실행을 탐지·차단한다.

---

## 운영 체크리스트

1. 애플리케이션 전체에 HTTPS가 적용되어 있는가?
2. 세션 쿠키에 `Secure`, `HttpOnly`, `SameSite`가 설정되어 있는가?
3. 로그인 후 세션 ID를 재발급하는가?
4. 세션 타임아웃(Idle/Absolute)이 적절히 설정되어 있는가?
5. XSS·CSRF 방어가 적용되어 있는가?
6. SIEM에 동시 접속·지리적 이동 탐지 규칙이 있는가?
7. EDR로 로컬 패킷 캡처 도구 실행을 탐지하는가?
8. 의심 세션 발견 시 자동 무효화 및 사용자 통보 절차가 정의되어 있는가?

---

## 결론

세션 하이재킹은 다양한 벡터로 발생하며, 탐지는 **네트워크·호스트·행위** 이벤트의 상관분석이 핵심이다.       
대응은 **전송 계층 암호화**, **쿠키·세션 관리 강화**, **애플리케이션 보안**, **운영 모니터링**의 결합으로 구현한다.


